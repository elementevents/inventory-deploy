import{s as y,j as t,z as j,a$ as f,d as S,B as v}from"./index-BNKejGDJ.js";import{D as x,a as g,q as B}from"./constants-CTS4Tt_R.js";import{D as C,u as E,s as _,b as A,a as N}from"./tableSortMapper-BzJsI_qb.js";import{u as D}from"./useCount-BX7DUR5m.js";import{u as F}from"./skeleton-LSo8Me7d.js";import"./counts-Yky57WYm.js";async function b(e,{pageIndex:o=x,pageSize:i=g,q:r,sortBy:c}){const a=o*i,d=a+i-1;let s=y.rpc("get_uncounted_bins",{p_count_id:e},{count:"exact"}).range(a,d);r&&r.trim()&&(s=s.or(`name.ilike.%${r}%`)),c&&c.length>0?c.split(",").forEach(m=>{const[p,h]=m.split(".");s=s.order(p,{ascending:h==="asc"})}):s=s.order("name",{ascending:!0});const{data:u,error:l,count:n}=await s;if(l)throw l;return{result:u,total:n??0}}function T(e,o){return F({queryKey:B.uncountedBins.forCount(e,o),queryFn:()=>b(e,o)})}const U=[{accessorKey:"name",header:({column:e})=>t.jsx(C,{column:e,title:"Name"}),cell:({row:e})=>{const o=e.original.is_active;return t.jsx("div",{className:j("max-w-[200px] truncate font-medium",{"opacity-30":!o}),children:e.getValue("name")})}}];function L(){const{id:e}=f.useParams(),{user:o}=S(),{filters:i,setFilters:r}=E(f.id),{data:c}=D(e),{data:a,isLoading:d}=T(e,i),s={pageIndex:i.pageIndex??x,pageSize:i.pageSize??g},u=_(i.sortBy);if(o===null)return t.jsx("div",{});const l=c?`Uncounted Bins â€” "${c.name}"`:"Uncounted Bins";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsxs("div",{className:"flex flex-col space-y-1.5",children:[t.jsx("h3",{className:"text-2xl font-semibold leading-none tracking-tight",children:l}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Active bins in the store with no count details for this count."})]}),t.jsx("div",{className:"ml-auto flex items-center gap-2",children:t.jsx(v,{size:"sm",variant:"outline",disabled:!0,children:"Export All"})})]}),t.jsx(A,{columns:U,data:(a==null?void 0:a.result)??[],filterPlaceholder:"Search bins...",isLoading:d,onSearchFieldChange:n=>{r({q:n,pageIndex:0})},onSortingChange:n=>{const m=typeof n=="function"?n(u):n;return r({sortBy:N(m)})},pagination:s,paginationOptions:{onPaginationChange:n=>{r(typeof n=="function"?n(s):n)},rowCount:a==null?void 0:a.total},searchValue:i.q??"",sorting:u})]})}export{L as component};
