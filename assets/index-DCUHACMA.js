import{A as N,u as F,b,m as D,aR as L,n as q,aS as A,r as E,j as e,F as R,o as i,p as l,q as d,t as I,I as T,v as c}from"./index-D8216wL9.js";import{t as V}from"./zod-Co59NxBk.js";import{B as k}from"./Button-BP0rxxDZ.js";import{C as h}from"./Combobox-CwRSFas5.js";import{u as K,D as f}from"./useCountTypes-Qt2zXi92.js";import{F as M}from"./FormSkeleton-JDmq8xLL.js";import{u as Q}from"./useCount-BZvT398A.js";import{a as U}from"./useStores-BD8DhiP5.js";import{u as B}from"./useMutation-CIZsXs7c.js";import{q as v}from"./constants-CTS4Tt_R.js";import{u as P}from"./counts-B4WSDNtF.js";import"./chevrons-up-down-s0IZNke8.js";import"./skeleton-0mPzxIqF.js";import"./stores-B5Ba0JL1.js";const z=[{id:"active",name:"Active"},{id:"inactive",name:"Inactive"},{id:"recount",name:"Recount"},{id:"archived",name:"Archived"}];function G(m){const u=N(),o=F(),{toast:x}=b();return B({mutationFn:n=>P(m,n),onSuccess:()=>{u.invalidateQueries({queryKey:v.counts.detail(m)}),u.invalidateQueries({queryKey:v.counts.lists()}),o({to:"/counts"}),x({title:"Count updated successfully!",description:"The count has been updated."})},onError:n=>{let r="Something went wrong!";(D(n)||n instanceof Error)&&(r=n.message),x({title:"Failed to update count!",description:r,variant:"destructive"})}})}function oe(){const{id:m}=L.useParams(),{data:u,error:o,isLoading:x}=U(),{data:n,error:r,isLoading:C}=K(),{data:t,error:p,isLoading:_}=Q(m),y=G(m),s=q({resolver:V(A),defaultValues:{count_type_id:(t==null?void 0:t.count_type.id)??"",end_at:t!=null&&t.end_at?new Date(t.end_at):new Date,name:(t==null?void 0:t.name)??"",start_at:t!=null&&t.start_at?new Date(t.start_at):new Date,status:(t==null?void 0:t.status)??"active",store_id:(t==null?void 0:t.store.id)??""}}),{reset:j}=s;E.useEffect(()=>{t&&j({count_type_id:t.count_type.id,end_at:t.end_at?new Date(t.end_at):new Date,name:t.name,start_at:t.start_at?new Date(t.start_at):new Date,status:t.status,store_id:t.store.id})},[t,j]);async function S(g){await y.mutateAsync(g)}const w=()=>C||x||_?e.jsx(M,{}):o||p||r?e.jsx("p",{className:"text-red-500",children:e.jsxs("p",{children:["Error:"," ",(o==null?void 0:o.message)||(p==null?void 0:p.message)||(r==null?void 0:r.message)]})}):t?u?n?e.jsx(R,{...s,children:e.jsxs("form",{className:"max-w-2xl",onSubmit:s.handleSubmit(S),children:[e.jsx("div",{className:"w-full grid gap-2",children:e.jsx(i,{control:s.control,name:"name",render:({field:a})=>e.jsxs(l,{className:"w-full",children:[e.jsx(d,{children:"Name"}),e.jsx(I,{children:e.jsx(T,{placeholder:"Count name",required:!0,...a})}),e.jsx(c,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(i,{control:s.control,name:"start_at",render:({field:a})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsx(d,{children:"Start date"}),e.jsx(f,{onSelect:a.onChange,selected:a.value}),e.jsx(c,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(i,{control:s.control,name:"end_at",render:({field:a})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsx(d,{children:"End date"}),e.jsx(f,{onSelect:a.onChange,selected:a.value}),e.jsx(c,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(i,{control:s.control,name:"store_id",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Store"}),e.jsx(h,{items:u??[],onValueChange:a.onChange,placeholder:"Select a store",value:a.value}),e.jsx(c,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(i,{control:s.control,name:"count_type_id",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Count type"}),e.jsx(h,{items:n??[],onValueChange:a.onChange,placeholder:"Select a count type",value:a.value}),e.jsx(c,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(i,{control:s.control,name:"status",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Status"}),e.jsx(h,{items:z,onValueChange:a.onChange,placeholder:"Select a status",value:a.value}),e.jsx(c,{})]})})}),e.jsx(k,{className:"w-full mt-8",isLoading:s.formState.isSubmitting,label:"Save",loadingLabel:"Saving...",type:"submit"})]})}):e.jsx("p",{className:"text-red-500",children:"Can't fetch count types data."}):e.jsx("p",{className:"text-red-500",children:"Can't fetch stores data."}):e.jsx("p",{className:"text-red-500",children:"Can't fetch count data."});return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-none tracking-tight",children:"Update Count"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update a count."})]})}),e.jsx("div",{children:w()})]})}export{oe as component};
