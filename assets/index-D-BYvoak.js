import{j as t,z as d,y as w,N as $,r as j,Q as B,T as F,B as K,U as T,V,W as P,X as R,Y as q,Z as z,_ as A,$ as b,a0 as L,d as O,a1 as G}from"./index-8T-MMjvt.js";import{q as U,a as J,D as M}from"./constants-CTS4Tt_R.js";import{e as H}from"./exportAllServerSide-DFA51smE.js";import{D as g,P as k,C as Q,u as Y,s as X,a as Z}from"./tableSortMapper-C_fSPYx1.js";import{D as W}from"./DataTableRowActions-DE0ihOQS.js";import{U as ee}from"./user-BXxfqXfo.js";import{G as te}from"./GenericDataDisplay-C_exBnFO.js";import{u as se}from"./skeleton-DzHUreFG.js";import{l as ae}from"./countDetails-Cdf43Pbb.js";import{a as re}from"./useCounts-D9AwmBSO.js";import{a as ne}from"./useUsers-BXiTxr4h.js";import"./download-BvrTFbBO.js";import"./circle-plus-D4yY0Pk_.js";import"./counts-BXjFN7S7.js";import"./users-cJNzLOOw.js";const ie=o=>{const i=[{accessorKey:"inventory_name",header:({column:e})=>t.jsx(g,{column:e,title:"Inventory"}),cell:({row:e})=>{const a=e.getValue("inventory_name"),n=e.original.is_active;return t.jsx("div",{className:d("max-w-[800px] truncate font-medium",{"opacity-30":!n}),children:`[${e.original.inventory_id}] ${a}`})},filterFn:(e,a,n)=>{const r=e.getValue(a),l=e.original.inventory_id??"",m=n.toLowerCase();return r.toLowerCase().includes(m)||l.toLowerCase().includes(m)}},{accessorKey:"quantity",accessorFn:e=>`${e.quantity} ${e.unit_name}`,header:({column:e})=>t.jsx(g,{column:e,title:"Quantity"}),cell:({row:e})=>{const a=e.original.is_active;return t.jsx("div",{className:d("max-w-[150px]",{"opacity-30":!a}),children:e.getValue("quantity")})}},{accessorKey:"bin",header:({column:e})=>t.jsx(g,{column:e,title:"Bin"}),cell:({row:e})=>{const a=e.original.bin_name??"",n=e.original.is_active;return t.jsx("div",{className:d("max-w-[400px] truncate",{"opacity-30":!n}),children:a})}},{accessorKey:"count",header:({column:e})=>t.jsx(g,{column:e,title:"Count"}),cell:({row:e})=>{const a=e.original.count_name??"",n=e.original.is_active;return t.jsx("div",{className:d("max-w-[500px] truncate",{"opacity-30":!n}),children:a})}},{accessorKey:"comments",header:({column:e})=>t.jsx(g,{column:e,title:"Comments"}),cell:({row:e})=>{const a=e.original.is_active;return t.jsx("div",{className:d("max-w-[600px]",{"opacity-30":!a}),children:e.getValue("comments")||"--"})}},{accessorKey:"is_damaged",header:({column:e})=>t.jsx(g,{column:e,title:"Damaged"}),cell:({row:e})=>{const a=e.original.is_active;return t.jsx("div",{className:d("max-w-[100px]",{"opacity-30":!a}),children:`${e.getValue("is_damaged")}`})}},{accessorKey:"created_at",header:({column:e})=>t.jsx(g,{column:e,title:"Creation date"}),cell:({row:e})=>{const a=e.original.is_active;return t.jsx("div",{className:d("max-w-[150px]",{"opacity-30":!a}),children:w(e.getValue("created_at"),"MMM dd, yyyy h:mma")})}},{accessorKey:"count_status",header:({column:e})=>t.jsx(g,{column:e,title:"Count status"}),cell:({row:e})=>{const a=e.original.is_active;return t.jsx("div",{className:d("flex items-center max-w-[150px]",{"opacity-30":!a}),children:e.getValue("count_status")})}},{accessorKey:"creator",header:({column:e})=>t.jsx(g,{column:e,title:"Creator"}),cell:({row:e})=>{const a=e.original.creator_first_name??"",n=e.original.creator_last_name??"",r=e.original.is_active;return t.jsxs("div",{className:d("flex items-center max-w-[150px]",{"opacity-30":!r}),children:[t.jsx(ee,{className:"h-3.5 w-3.5 shrink-0 mr-1"}),`${a} ${n}`]})}}];return["admin","manager","counter"].includes(o)&&i.push({id:"actions",cell:({row:e})=>t.jsx(W,{editHref:`/count_details/${e.original.id}`,row:e})}),i},oe=$("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function I({className:o,variant:i,...e}){return t.jsx("div",{className:d(oe({variant:i}),o),...e})}function D({title:o="Counts",options:i,value:e=[],onChange:a}){const n=j.useMemo(()=>new Set(e),[e]);return t.jsxs(B,{children:[t.jsx(F,{asChild:!0,children:t.jsxs(K,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[t.jsx(k,{className:"mr-2 h-4 w-4"}),o,n.size>0&&t.jsxs(t.Fragment,{children:[t.jsx(T,{orientation:"vertical",className:"mx-2 h-4"}),t.jsx(I,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),t.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?t.jsxs(I,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):i.filter(r=>n.has(r.id)).map(r=>t.jsx(I,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.name},r.id))})]})]})}),t.jsx(V,{className:"w-[200px] p-0",align:"start",children:t.jsxs(P,{children:[t.jsx(R,{placeholder:o}),t.jsxs(q,{children:[t.jsx(z,{children:"No results found."}),t.jsx(A,{children:i.map(r=>{const l=n.has(r.id);return t.jsxs(b,{onSelect:()=>{const m=new Set(n);l?m.delete(r.id):m.add(r.id),a(Array.from(m))},children:[t.jsx("div",{className:d("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",l?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:t.jsx(Q,{className:d("h-4 w-4")})}),t.jsx("span",{children:r.name})]},r.id)})}),n.size>0&&t.jsxs(t.Fragment,{children:[t.jsx(L,{}),t.jsx(A,{children:t.jsx(b,{onSelect:()=>a([]),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function ce(o){return se({queryKey:U.countDetails.list(o),queryFn:()=>ae(o)})}function Se(){const{user:o}=O(),{filters:i,setFilters:e}=Y(G.id),{data:a,isLoading:n}=ce(i),{data:r}=re(),{data:l}=ne(),m="countDetails.selectedCountIds",C="countDetails.selectedCreatorIds",x=j.useRef(!1),y=j.useRef(!1);j.useEffect(()=>{var u;if(x.current||!r)return;const s=((u=i.countIds)==null?void 0:u.split(",").filter(Boolean))??[];if(s.length>0){localStorage.setItem(m,JSON.stringify(s)),x.current=!0;return}try{const f=localStorage.getItem(m);if(!f){x.current=!0;return}const p=JSON.parse(f),h=Array.isArray(p)?p.filter(c=>typeof c=="string"):[];if(h.length===0){x.current=!0;return}const _=new Set((r??[]).map(c=>c.id??"")),v=h.filter(c=>c&&_.has(c));v.length>0&&e({countIds:v.join(","),pageIndex:0})}catch{}finally{x.current=!0}},[r]),j.useEffect(()=>{var u;if(y.current||!l)return;const s=((u=i.creatorIds)==null?void 0:u.split(",").filter(Boolean))??[];if(s.length>0){localStorage.setItem(C,JSON.stringify(s)),y.current=!0;return}try{const f=localStorage.getItem(C);if(!f){y.current=!0;return}const p=JSON.parse(f),h=Array.isArray(p)?p.filter(c=>typeof c=="string"):[];if(h.length===0){y.current=!0;return}const _=new Set((l??[]).map(c=>c.id??"")),v=h.filter(c=>c&&_.has(c));v.length>0&&e({creatorIds:v.join(","),pageIndex:0})}catch{}finally{y.current=!0}},[l]);const S={pageIndex:i.pageIndex??M,pageSize:i.pageSize??J},N=X(i.sortBy);if(o===null)return t.jsx("div",{});const E=["admin"].includes(o.role);return t.jsx(te,{allowExport:E,columns:ie(o.role),data:a,description:"Manage your count details.",filterPlaceholder:"Search by inventory name, ID, or bin...",isLoading:n,toolbarFilters:t.jsxs(t.Fragment,{children:[((r==null?void 0:r.length)??0)>1?t.jsx(D,{title:"Counts",options:(r??[]).map(s=>({id:s.id??"",name:s.name??""})),value:i.countIds?i.countIds.split(",").filter(Boolean):[],onChange:s=>{e({countIds:s.length?s.join(","):void 0,pageIndex:0}),s.length>0?localStorage.setItem(m,JSON.stringify(s)):localStorage.removeItem(m)}}):null,((l==null?void 0:l.length)??0)>1?t.jsx(D,{title:"Creators",options:(l??[]).sort((s,u)=>{const f=`${s.first_name} ${s.last_name}`.toLowerCase(),p=`${u.first_name} ${u.last_name}`.toLowerCase();return f.localeCompare(p)}).map(s=>({id:s.id??"",name:`${s.first_name} ${s.last_name}`})),value:i.creatorIds?i.creatorIds.split(",").filter(Boolean):[],onChange:s=>{e({creatorIds:s.length?s.join(","):void 0,pageIndex:0}),s.length>0?localStorage.setItem(C,JSON.stringify(s)):localStorage.removeItem(C)}}):null]}),searchValue:i.q??"",onExportClick:async()=>H("count_details"),onSearchFieldChange:s=>{e({q:s,pageIndex:0})},onSortingChange:s=>{const u=typeof s=="function"?s(N):s;return e({sortBy:Z(u)})},pagination:S,paginationOptions:{onPaginationChange:s=>{e(typeof s=="function"?s(S):s)},rowCount:a==null?void 0:a.total},sorting:N,title:"Count Details"})}export{Se as component};
