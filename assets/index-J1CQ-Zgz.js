import{j as t,x as l,y as b,M as A,r as g,N as D,Q as E,B as w,T as F,U as K,V,W as B,X as P,Y as q,Z as _,_ as N,$ as T,d as $,a0 as z}from"./index-Dkc07M4j.js";import{q as L,a as G,D as M}from"./constants-BmjxfpbN.js";import{e as R}from"./exportAllServerSide-NQBMmmQf.js";import{D as u,P as U,C as k,u as H,s as J,a as O}from"./tableSortMapper-CYxrmb2A.js";import{D as Q}from"./DataTableRowActions-DqLhODBg.js";import{U as X}from"./user-BWhzfn4a.js";import{G as Y}from"./GenericDataDisplay-CLAep9xb.js";import{u as Z}from"./skeleton-DOBrNw0t.js";import{l as W}from"./countDetails-BzxTFqUQ.js";import{a as ee}from"./useCounts-CQygFfcR.js";import"./download-4VWbFYEa.js";import"./circle-plus-B_FxCKfQ.js";import"./counts-POYZhyaG.js";const te=o=>{const i=[{accessorKey:"inventory_name",header:({column:e})=>t.jsx(u,{column:e,title:"Inventory"}),cell:({row:e})=>{const s=e.getValue("inventory_name"),n=e.original.is_active;return t.jsx("div",{className:l("max-w-[300px] truncate font-medium",{"opacity-30":!n}),children:`[${e.original.inventory_id}] ${s}`})},filterFn:(e,s,n)=>{const a=e.getValue(s),d=e.original.inventory_id??"",c=n.toLowerCase();return a.toLowerCase().includes(c)||d.toLowerCase().includes(c)}},{accessorKey:"quantity",accessorFn:e=>`${e.quantity} ${e.unit_name}`,header:({column:e})=>t.jsx(u,{column:e,title:"Quantity"}),cell:({row:e})=>{const s=e.original.is_active;return t.jsx("div",{className:l("max-w-[150px]",{"opacity-30":!s}),children:e.getValue("quantity")})}},{accessorKey:"bin",header:({column:e})=>t.jsx(u,{column:e,title:"Bin"}),cell:({row:e})=>{const s=e.original.bin_name??"",n=e.original.is_active;return t.jsx("div",{className:l("max-w-[200px] truncate",{"opacity-30":!n}),children:s})}},{accessorKey:"count",header:({column:e})=>t.jsx(u,{column:e,title:"Count"}),cell:({row:e})=>{const s=e.original.count_name??"",n=e.original.is_active;return t.jsx("div",{className:l("max-w-[300px] truncate",{"opacity-30":!n}),children:s})}},{accessorKey:"comments",header:({column:e})=>t.jsx(u,{column:e,title:"Comments"}),cell:({row:e})=>{const s=e.original.is_active;return t.jsx("div",{className:l("max-w-[300px]",{"opacity-30":!s}),children:e.getValue("comments")||"--"})}},{accessorKey:"is_damaged",header:({column:e})=>t.jsx(u,{column:e,title:"Damaged"}),cell:({row:e})=>{const s=e.original.is_active;return t.jsx("div",{className:l("max-w-[100px]",{"opacity-30":!s}),children:`${e.getValue("is_damaged")}`})}},{accessorKey:"created_at",header:({column:e})=>t.jsx(u,{column:e,title:"Creation date"}),cell:({row:e})=>{const s=e.original.is_active;return t.jsx("div",{className:l("max-w-[150px]",{"opacity-30":!s}),children:b(e.getValue("created_at"),"MMM dd, yyyy h:mma")})}},{accessorKey:"count_status",header:({column:e})=>t.jsx(u,{column:e,title:"Count status"}),cell:({row:e})=>{const s=e.original.is_active;return t.jsx("div",{className:l("flex items-center max-w-[150px]",{"opacity-30":!s}),children:e.getValue("count_status")})}},{accessorKey:"creator",header:({column:e})=>t.jsx(u,{column:e,title:"Creator"}),cell:({row:e})=>{const s=e.original.creator_first_name??"",n=e.original.creator_last_name??"",a=e.original.is_active;return t.jsxs("div",{className:l("flex items-center max-w-[150px]",{"opacity-30":!a}),children:[t.jsx(X,{className:"h-3.5 w-3.5 shrink-0 mr-1"}),`${s} ${n}`]})}}];return["admin","manager","counter"].includes(o)&&i.push({id:"actions",cell:({row:e})=>t.jsx(Q,{editHref:`/count_details/${e.original.id}`,row:e})}),i},se=A("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function p({className:o,variant:i,...e}){return t.jsx("div",{className:l(se({variant:i}),o),...e})}function ae({title:o="Counts",options:i,value:e=[],onChange:s}){const n=g.useMemo(()=>new Set(e),[e]);return t.jsxs(D,{children:[t.jsx(E,{asChild:!0,children:t.jsxs(w,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[t.jsx(U,{className:"mr-2 h-4 w-4"}),o,n.size>0&&t.jsxs(t.Fragment,{children:[t.jsx(F,{orientation:"vertical",className:"mx-2 h-4"}),t.jsx(p,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),t.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?t.jsxs(p,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):i.filter(a=>n.has(a.id)).map(a=>t.jsx(p,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:a.name},a.id))})]})]})}),t.jsx(K,{className:"w-[200px] p-0",align:"start",children:t.jsxs(V,{children:[t.jsx(B,{placeholder:o}),t.jsxs(P,{children:[t.jsx(q,{children:"No results found."}),t.jsx(_,{children:i.map(a=>{const d=n.has(a.id);return t.jsxs(N,{onSelect:()=>{const c=new Set(n);d?c.delete(a.id):c.add(a.id),s(Array.from(c))},children:[t.jsx("div",{className:l("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",d?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:t.jsx(k,{className:l("h-4 w-4")})}),t.jsx("span",{children:a.name})]},a.id)})}),n.size>0&&t.jsxs(t.Fragment,{children:[t.jsx(T,{}),t.jsx(_,{children:t.jsx(N,{onSelect:()=>s([]),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function ne(o){return Z({queryKey:L.countDetails.list(o),queryFn:()=>W(o)})}function he(){const{user:o}=$(),{filters:i,setFilters:e}=H(z.id),{data:s,isLoading:n}=ne(i),{data:a}=ee(),d="countDetails.selectedCountIds",c=g.useRef(!1);g.useEffect(()=>{var x;if(c.current||!a)return;const r=((x=i.countIds)==null?void 0:x.split(",").filter(Boolean))??[];if(r.length>0){localStorage.setItem(d,JSON.stringify(r)),c.current=!0;return}try{const h=localStorage.getItem(d);if(!h){c.current=!0;return}const v=JSON.parse(h),j=Array.isArray(v)?v.filter(m=>typeof m=="string"):[];if(j.length===0){c.current=!0;return}const I=new Set((a??[]).map(m=>m.id??"")),C=j.filter(m=>m&&I.has(m));C.length>0&&e({countIds:C.join(","),pageIndex:0})}catch{}finally{c.current=!0}},[a]);const f={pageIndex:i.pageIndex??M,pageSize:i.pageSize??G},y=J(i.sortBy);if(o===null)return t.jsx("div",{});const S=["admin"].includes(o.role);return t.jsx(Y,{allowExport:S,columns:te(o.role),data:s,description:"Manage your count details.",filterPlaceholder:"Search count details...",isLoading:n,toolbarFilters:((a==null?void 0:a.length)??0)>1?t.jsx(ae,{title:"Counts",options:(a??[]).map(r=>({id:r.id??"",name:r.name??""})),value:i.countIds?i.countIds.split(",").filter(Boolean):[],onChange:r=>{e({countIds:r.length?r.join(","):void 0,pageIndex:0}),r.length>0?localStorage.setItem(d,JSON.stringify(r)):localStorage.removeItem(d)}}):null,searchValue:i.q??"",onExportClick:async()=>R("count_details"),onSearchFieldChange:r=>{e({q:r,pageIndex:0})},onSortingChange:r=>{const x=typeof r=="function"?r(y):r;return e({sortBy:O(x)})},pagination:f,paginationOptions:{onPaginationChange:r=>{e(typeof r=="function"?r(f):r)},rowCount:s==null?void 0:s.total},sorting:y,title:"Count Details"})}export{he as component};
