import{c as j,A as S,b as F,m as C,u as J,af as _,r as g,n as M,ag as W,j as e,a5 as A,a7 as O,F as q,a8 as K,a9 as T,aa as V,o as w,p as v,t as x,I as f,B as N,v as b,ab as P,ah as X,q as p,L as Y,ai as Z,aj as ee,ak as se,al as ae,am as te,an as ne,ao as ie}from"./index-D8216wL9.js";import{t as D}from"./zod-Co59NxBk.js";import{B as L}from"./Button-BP0rxxDZ.js";import{F as re}from"./FormSkeleton-JDmq8xLL.js";import{u as E}from"./useMutation-CIZsXs7c.js";import{q as u}from"./constants-CTS4Tt_R.js";import{r as le,t as oe,a as ce,b as de,d as me}from"./users-BxHg0d9T.js";import{u as ue}from"./skeleton-0mPzxIqF.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=j("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=j("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=j("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=j("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=j("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=j("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),ye=[{id:"counter",label:"Counter"},{id:"manager",label:"Manager"},{id:"admin",label:"Admin"}];function we(a){const n=S(),{toast:t}=F();return E({mutationFn:s=>le(a,s),onSuccess:()=>{n.invalidateQueries({queryKey:u.users.all}),t({title:"User password reset successfully!",description:"The user password has been set."})},onError:s=>{let i="Something went wrong!";(C(s)||s instanceof Error)&&(i=s.message),t({title:"Failed to reset user password!",description:i,variant:"destructive"})}})}function ve(a){const n=S(),{toast:t}=F();return E({mutationFn:()=>oe(a),onSuccess:()=>{n.invalidateQueries({queryKey:u.users.all}),t({title:"User active state toggled successfully!",description:"The user active state has been toggled."})},onError:s=>{let i="Something went wrong!";(C(s)||s instanceof Error)&&(i=s.message),t({title:"Failed to toggle user active state!",description:i,variant:"destructive"})}})}function be(a){const n=S(),t=J(),{toast:s}=F();return E({mutationFn:i=>ce(a,i),onSuccess:()=>{n.invalidateQueries({queryKey:u.users.detail(a)}),n.invalidateQueries({queryKey:u.users.lists()}),t({to:"/users"}),s({title:"User updated successfully!",description:"The user has been updated."})},onError:i=>{let r="Something went wrong!";(C(i)||i instanceof Error)&&(r=i.message),s({title:"Failed to update user!",description:r,variant:"destructive"})}})}function Ne(a){const n=S();return E({mutationFn:t=>de(a,t),onSuccess:async()=>{await n.invalidateQueries({queryKey:u.users.detail(a)}),await n.invalidateQueries({queryKey:u.users.lists()}),_({title:"User email updated successfully!",description:"The user email has been updated."})},onError:t=>{let s="Something went wrong!";C(t)?s=`${t.message}`:t instanceof Error&&(s=`${t.message}. It's possible that the email already exists.`),console.log("error",s),_({title:"Failed to update user email!",description:s,variant:"destructive"})}})}function Se(a){return ue({queryKey:u.users.detail(a),queryFn:async()=>me(a)})}function Ce({isOpen:a,isProcessing:n,onOpenChange:t,onSubmitData:s}){const[i,r]=g.useState(!1),o=M({defaultValues:{new_password:""},resolver:D(W)}),m=o.reset;g.useEffect(()=>{a||m()},[a,m]);function c(){r(d=>!d)}function k(d){n||t(d)}const y=i?he:pe;return e.jsx(A,{onOpenChange:k,open:a,children:e.jsx(O,{className:"sm:max-w-md",children:e.jsx(q,{...o,children:e.jsxs("form",{className:"space-y-4",onSubmit:o.handleSubmit(s),children:[e.jsxs(K,{children:[e.jsx(T,{children:"Reset password"}),e.jsx(V,{children:"This action will be logged. Ensure you have a valid reason for performing this password reset."})]}),e.jsx(w,{control:o.control,name:"new_password",render:({field:d})=>e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"grid flex-1 gap-2",children:e.jsx(x,{children:e.jsx(f,{autoComplete:"off",disabled:n,placeholder:"New password",type:i?"text":"password",...d})})}),e.jsx(N,{disabled:n,type:"button",className:"px-3",onClick:c,size:"sm",children:e.jsx(y,{className:"h-4 w-4"})})]}),e.jsx(b,{})]})}),e.jsx(P,{className:"sm:justify-start",children:e.jsx(L,{isLoading:n,label:"Reset password",loadingLabel:"Resetting password...",type:"submit"})})]})})})})}function Ee({currentEmail:a,isOpen:n,isProcessing:t,onOpenChange:s,onSubmitData:i}){const r=M({defaultValues:{new_email:""},resolver:D(X)}),o=r.reset;g.useEffect(()=>{n||o()},[n,o]);function m(c){t||s(c)}return e.jsx(A,{onOpenChange:m,open:n,children:e.jsx(O,{className:"sm:max-w-md",children:e.jsx(q,{...r,children:e.jsxs("form",{className:"space-y-4",onSubmit:r.handleSubmit(i),children:[e.jsxs(K,{children:[e.jsx(T,{children:"Change email"}),e.jsxs(V,{children:["Current email: ",a||"N/A"]})]}),e.jsx(w,{control:r.control,name:"new_email",render:({field:c})=>e.jsxs(v,{children:[e.jsx(p,{children:"New email"}),e.jsx(x,{children:e.jsx(f,{autoComplete:"off",disabled:t,placeholder:"name@example.com",type:"email",...c})}),e.jsx(b,{})]})}),e.jsx(P,{className:"sm:justify-start",children:e.jsx(L,{isLoading:t,label:"Update email",loadingLabel:"Updating...",type:"submit"})})]})})})})}function ke({isActive:a,isLoading:n,onClick:t}){const s=()=>n?e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):a?e.jsx(ge,{className:"h-3.5 w-3.5"}):e.jsx(fe,{className:"h-3.5 w-3.5"}),i=()=>n?"Updating...":a?"Set inactive":"Set active";return e.jsxs(N,{className:"ml-auto h-8 gap-1",disabled:n,onClick:t,size:"sm",children:[s(),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:i()})]})}function Ae(){const{id:a}=Z.useParams(),[n,t]=g.useState(!1),{data:s,error:i,isLoading:r}=Se(a),o=be(a),m=ve(a),c=we(a),[k,y]=g.useState(!1),d=Ne(a),h=M({resolver:D(ee),values:{first_name:(s==null?void 0:s.first_name)??"",last_name:(s==null?void 0:s.last_name)??"",role:(s==null?void 0:s.role)??""}}),{formState:{isSubmitting:Q},reset:R}=h;g.useEffect(()=>{s&&R({first_name:s.first_name,last_name:s.last_name,role:s.role})},[R,s]);async function z(l){await o.mutateAsync(l)}function I(){t(!0)}function B(){y(!0)}async function $(){await m.mutateAsync()}async function H(l){await c.mutateAsync(l)}const G=()=>r?e.jsx(re,{}):i?e.jsxs("p",{className:"text-red-500",children:["Error: ",i.message]}):s?e.jsx(q,{...h,children:e.jsxs("form",{className:"max-w-2xl",onSubmit:h.handleSubmit(z),children:[e.jsx("div",{className:"w-full grid gap-2",children:e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(p,{children:"Employee number"}),e.jsx(x,{children:e.jsx(f,{placeholder:"Employee number",value:s.employee_number,disabled:!0})})]})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(p,{children:"Email"}),e.jsx(f,{placeholder:"Email",value:s.email,disabled:!0})]})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(w,{control:h.control,name:"first_name",render:({field:l})=>e.jsxs(v,{className:"w-full",children:[e.jsx(p,{children:"First name"}),e.jsx(x,{children:e.jsx(f,{placeholder:"First name",required:!0,...l})}),e.jsx(b,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(w,{control:h.control,name:"last_name",render:({field:l})=>e.jsxs(v,{className:"w-full",children:[e.jsx(p,{children:"Last name"}),e.jsx(x,{children:e.jsx(f,{placeholder:"Last name",required:!0,...l})}),e.jsx(b,{})]})})}),e.jsx("div",{className:"w-full grid gap-2 mt-4",children:e.jsx(w,{control:h.control,name:"role",render:({field:l})=>e.jsxs(v,{children:[e.jsx(p,{children:"Role"}),e.jsxs(se,{onValueChange:l.onChange,value:l.value,children:[e.jsx(x,{children:e.jsx(ae,{children:e.jsx(te,{placeholder:"Select a role"})})}),e.jsx(ne,{children:ye.map(U=>e.jsx(ie,{value:U.id,children:U.label},U.id))})]}),e.jsx(b,{})]})})}),e.jsx(L,{className:"w-full mt-8",isLoading:Q,label:"Save",loadingLabel:"Saving...",type:"submit"})]})}):e.jsx("p",{className:"text-red-500",children:"Can't fetch user data."});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-none tracking-tight",children:"Update User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update user details."})]}),s&&e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs(N,{className:"ml-auto h-8 gap-1",onClick:B,size:"sm",variant:"outline",children:[e.jsx(je,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:"Change email"})]}),e.jsxs(N,{className:"ml-auto h-8 gap-1",onClick:I,size:"sm",variant:"destructive",children:[e.jsx(xe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:"Reset password"})]}),e.jsx(ke,{isActive:s.is_active,isLoading:m.isPending,onClick:$})]})]}),e.jsxs("div",{children:[G(),e.jsx(Ce,{isOpen:n,isProcessing:c.isPending,onOpenChange:t,onSubmitData:H}),e.jsx(Ee,{currentEmail:s==null?void 0:s.email,isOpen:k,isProcessing:d.isPending,onOpenChange:y,onSubmitData:async l=>{await d.mutateAsync(l),y(!1)}})]})]})}export{Ae as component};
