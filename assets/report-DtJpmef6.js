import{s as y,j as e,x as j,aZ as f,d as S,B as v}from"./index-D0UzDXdb.js";import{D as x,a as g,q as B}from"./constants-BmjxfpbN.js";import{D as C,u as E,s as _,b as A,a as N}from"./tableSortMapper-CSDzbaka.js";import{u as D}from"./useCount-B5Xn7iEM.js";import{u as F}from"./skeleton-DTNZejXw.js";import"./counts-SqIoWuzr.js";async function b(t,{pageIndex:a=x,pageSize:i=g,q:r,sortBy:c}){const o=a*i,d=o+i-1;let s=y.rpc("get_uncounted_bins",{p_count_id:t},{count:"exact"}).range(o,d);r&&r.trim()&&(s=s.or(`name.ilike.%${r}%`)),c&&c.length>0?c.split(",").forEach(m=>{const[p,h]=m.split(".");s=s.order(p,{ascending:h==="asc"})}):s=s.order("name",{ascending:!0});const{data:u,error:l,count:n}=await s;if(l)throw l;return{result:u,total:n??0}}function T(t,a){return F({queryKey:B.uncountedBins.forCount(t),queryFn:()=>b(t,a)})}const U=[{accessorKey:"name",header:({column:t})=>e.jsx(C,{column:t,title:"Name"}),cell:({row:t})=>{const a=t.original.is_active;return e.jsx("div",{className:j("max-w-[200px] truncate font-medium",{"opacity-30":!a}),children:t.getValue("name")})}}];function R(){const{id:t}=f.useParams(),{user:a}=S(),{filters:i,setFilters:r}=E(f.id),{data:c}=D(t),{data:o,isLoading:d}=T(t,i),s={pageIndex:i.pageIndex??x,pageSize:i.pageSize??g},u=_(i.sortBy);if(a===null)return e.jsx("div",{});const l=c?`Uncounted Bins â€” "${c.name}"`:"Uncounted Bins";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-none tracking-tight",children:l}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active bins in the store with no count details for this count."})]}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsx(v,{size:"sm",variant:"outline",disabled:!0,children:"Export All"})})]}),e.jsx(A,{columns:U,data:(o==null?void 0:o.result)??[],filterPlaceholder:"Search bins...",isLoading:d,onSearchFieldChange:n=>{r({q:n,pageIndex:0})},onSortingChange:n=>{const m=typeof n=="function"?n(u):n;return r({sortBy:N(m)})},pagination:s,paginationOptions:{onPaginationChange:n=>{r(typeof n=="function"?n(s):n)},rowCount:o==null?void 0:o.total},sorting:u})]})}export{R as component};
