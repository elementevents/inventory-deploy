import{r as f,b as y,j as e,g as j,h as C,B as v,i as N,D as d,a as m,x as l,y as x,d as E,K as S}from"./index-DPT7YIch.js";import{a as A,D}from"./constants-CTS4Tt_R.js";import{c as w,D as u,u as _,s as L,a as T}from"./tableSortMapper-CtzKiZYD.js";import{e as g}from"./exportAllServerSide--TVgQWy3.js";import{C as b}from"./circle-plus-D9zEp_ea.js";import{G as I}from"./GenericDataDisplay-yYHGB76A.js";import{u as K}from"./useCounts-BbRlasrl.js";import"./skeleton-B4IKsskW.js";import"./download-D9RNW1gH.js";import"./counts-BRBGrJXr.js";function k({row:n}){const[i,t]=f.useState(!1),{toast:s}=y();async function c(){if(!i)try{t(!0),await g("count_details",{countId:n.original.id??""})}catch(a){let r="An unexpected error occurred";a instanceof Error?r=a.message:typeof a=="string"?r=a:typeof a=="object"&&a!==null&&("message"in a&&typeof a.message=="string"?r=a.message:r=JSON.stringify(a)),s({title:"Error fetching count details",description:r,variant:"destructive"})}finally{t(!1)}}return e.jsxs(j,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(v,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted ml-auto",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(N,{align:"end",className:"w-[160px]",children:[e.jsx(d,{onClick:c,children:"Export details"}),e.jsx(d,{asChild:!0,children:e.jsx(m,{className:"w-full cursor-pointer",to:"/counts/$id",params:{id:n.original.id??""},children:"Edit"})}),e.jsx(d,{asChild:!0,children:e.jsx(m,{className:"w-full cursor-pointer",to:"/counts/$id/access",params:{id:n.original.id??""},children:"Edit access"})}),e.jsx(d,{asChild:!0,children:e.jsx(m,{className:"w-full cursor-pointer",to:"/counts/$id/report",params:{id:n.original.id??""},children:"Uncounted bins report"})})]})]})}const B=n=>{const i=[{accessorKey:"name",header:({column:t})=>e.jsx(u,{column:t,title:"Name"}),cell:({row:t})=>{const s=t.original.status==="active";return s?e.jsxs(m,{className:"text-left inline-flex items-center font-semibold",to:"/count_details/new",search:{count:t.original.id??""},children:[e.jsx("span",{children:t.getValue("name")}),e.jsx(b,{className:"h-3.5 w-3.5 ml-1 shrink-0",strokeWidth:3})]}):e.jsx("div",{className:l("max-w-[300px] truncate",{"opacity-30":!s}),children:t.getValue("name")})}},{accessorKey:"start_at",header:({column:t})=>e.jsx(u,{column:t,title:"Starts at"}),cell:({row:t})=>{const s=t.original.status==="active";return e.jsx("div",{className:l("max-w-[100px] truncate",{"opacity-30":!s}),children:x(t.getValue("start_at"),"LLL dd, y")})}},{accessorKey:"end_at",header:({column:t})=>e.jsx(u,{column:t,title:"Ends at"}),cell:({row:t})=>{const s=t.original.status==="active";return e.jsx("div",{className:l("max-w-[100px] truncate",{"opacity-30":!s}),children:x(t.getValue("end_at"),"LLL dd, y")})}},{accessorKey:"store",header:({column:t})=>e.jsx(u,{column:t,title:"Store"}),cell:({row:t})=>{const s=t.original.store_name??"",c=t.original.status==="active";return e.jsx("div",{className:l("max-w-[200px] truncate",{"opacity-30":!c}),children:s})}},{accessorKey:"count_type",header:({column:t})=>e.jsx(u,{column:t,title:"Count type"}),cell:({row:t})=>{const s=t.original.count_type_name??"",c=t.original.status==="active";return e.jsx("div",{className:l("max-w-[100px] truncate",{"opacity-30":!c}),children:s})}},{accessorKey:"status",header:({column:t})=>e.jsx(u,{column:t,title:"Status"}),cell:({row:t})=>{const s=t.original.status==="active";return e.jsx("div",{className:l("max-w-[100px] truncate",{"opacity-30":!s}),children:t.getValue("status")})}}];return["admin"].includes(n)&&i.push({id:"actions",cell:({row:t})=>e.jsx(k,{row:t})}),i};function q(){const{user:n}=E(),{filters:i,setFilters:t}=_(S.id),{data:s,isLoading:c}=K(i),a={pageIndex:i.pageIndex??D,pageSize:i.pageSize??A},r=L(i.sortBy);if(n===null)return e.jsx("div",{});const p=["admin"].includes(n.role);return e.jsx(I,{allowCreation:p,allowExport:p,addHref:"/counts/new",addLabel:"Add Count",columns:B(n.role),data:s,description:"Manage your counts.",filterPlaceholder:"Search counts...",isLoading:c,searchValue:i.q??"",onExportClick:async()=>g("counts"),onSearchFieldChange:o=>{t({q:o,pageIndex:0})},onSortingChange:o=>{const h=typeof o=="function"?o(r):o;return t({sortBy:T(h)})},pagination:a,paginationOptions:{onPaginationChange:o=>{t(typeof o=="function"?o(a):o)},rowCount:s==null?void 0:s.total},sorting:r,title:"Counts"})}export{q as component};
